<div class="top d-flex justify-content-between">
  <h2>Danh sách tin tức</h2>
  <div class="right">
    <!-- <button class="btnX" pButton type="button" (click)="showAdd()" lable="Thêm"></button> -->
    <p-button
      (click)="showAdd()"
      icon="pi pi-plus"
      label="Thêm"
      style="margin-right: 5px;"
    ></p-button>
  </div>
</div>
<div class="bot">
  <p-panel header="Tìm kiếm" [style]="{'margin-top': '2px'}">
    <form
      class="form-horizontal"
      role="form"
      [formGroup]="formsearch"
      (ngSubmit)="search()"
    >
      <div class="form-group">
        <label class="col-sm-1 control-label no-padding-right"> Tiêu đề </label>
        <div class="col-sm-11 my-2">
          <input
            formControlName="tieuDe"
            class="form-control"
            type="text"
            placeholder="Tiêu đề..."
          />
        </div>
      </div>
      <div class="form-group">
        <!-- <label class="col-sm-1 control-label no-padding-right"></label> -->
        <div class="col-sm-11">
          <button
            (click)="search()"
            class="btn btn-sm btn-primary font-size-16 mt-2"
            style="padding: 6px 12px;"
          >
            Tìm kiếm
          </button>
        </div>
      </div>
    </form>
    <!-- Start Sort Select Option -->
    <div
      class="sort-select-list d-flex align-items-center mt-3 justify-content-end"
    >
      <div class="d-flex" style="margin-right: auto;">
        <label class="mx-2 d-flex align-items-center">Hiển thị:</label>
        <fieldset>
          <select
            class="form-control"
            [(ngModel)]="pageSize"
            (ngModelChange)="loadPage(1)"
          >
            <option selected value="3">3</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="20">50</option>
            <option value="{{totalItems}}">All</option>
          </select>
        </fieldset>
      </div>
      <button class="btn btn-success btn-block" (click)="openPDF()">
        Download PDF
      </button>
    </div>
    <!-- End Sort Select Option -->
    <!-- <div class="col-md-4 text-right">
      <button class="btn btn-success btn-block" (click)="openPDF()">
        Download PDF
      </button>
    </div> -->
  </p-panel>
  <p-table
    id="blog"
    selectionMode="single"
    [value]="blogs"
    styleClass="p-datatable-gridlines"
    [style]="{'margin-top': '1rem', 'width': '100%'}"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>STT</th>
        <th>Tiêu đề</th>
        <th>Mô tả</th>
        <th>Người đăng</th>
        <th>Ngày đăng</th>
        <th>Hình ảnh</th>
        <th>Thao tác</th>
      </tr>
    </ng-template>
    <ng-template
      pTemplate="body"
      let-blog
      let-i="rowIndex"
      let-expanded="expanded"
    >
      <tr>
        <td>{{i+1}}</td>
        <td style="width: 17%;">{{blog.tieuDe}}</td>
        <td style="width: 32%;" [innerHtml]="blog.moTa"></td>
        <td>{{blog.hoTen}}</td>
        <td>{{blog.ngayDang}}</td>
        <td>
          <img
            src="../../../../assets/images/img/{{blog.anh}}"
            width="150px"
            height="100px"
            alt=""
          />
        </td>
        <td>
          <!--  <button
            pButton
            type="button"
            (click)="edit(blog)"
            title="Sửa"
            class="btn btn-sm btn-primary"
            style="margin-right: 5px;"
          >
            <i class="fas fa-edit"></i>
          </button> -->
          <button
            pButton
            type="button"
            (click)="delete(blog.maTinTuc)"
            title="Xóa"
            class="p-button-danger"
          >
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <div class="mt-5 d-flex justify-content-center">
    <ngb-pagination
      [collectionSize]="totalItems"
      [pageSize]="pageSize"
      [(page)]="page"
      [maxSize]="10"
      [rotate]="true"
      (pageChange)="loadPage($event)"
    ></ngb-pagination>
  </div>
</div>

<!-- Add -->
<p-dialog
  [(visible)]="displayAdd"
  [style]="{width: '40vw'}"
  [dismissableMask]="true"
  [modal]="true"
>
  <form (ngSubmit)="AddNewBlog(form)" #form="ngForm">
    <h3>Thêm tin tức</h3>
    <div style="width: 100%;">
      <input type="hidden" name="maTinTuc" ngModel #maTinTuc="ngModel" />
      <label style="font-weight: bold;">Tiêu đề:</label>
      <input
        type="text"
        class="form-control my-1"
        name="tieuDe"
        ngModel
        #tieuDe="ngModel"
        placeholder="Tiêu đề"
      />
      <label style="font-weight: bold;">Mô tả:</label>
      <p-editor
        [style]="{'height':'220px','font-size':'16px'}"
        name="moTa"
        ngModel
        #moTa="ngModel"
        class="my-1"
      ></p-editor>
      <label style="font-weight: bold;">Nội dung:</label>
      <p-editor
        [style]="{'height':'220px','font-size':'16px'}"
        name="noiDung"
        ngModel
        #noiDung="ngModel"
        class="my-1"
      ></p-editor>
      <label style="font-weight: bold;">Người đăng: {{user.hoTen}}</label>
      <input
        type="text"
        class="form-control my-1"
        placeholder="Người đăng"
        [(ngModel)]="user.maNguoiDung"
        name="maNguoiDung"
        ngModel
        #maNguoiDung="ngModel"
      />
      <label style="font-weight: bold;">Ngày đăng:</label>
      <input
        type="date"
        class="form-control my-1"
        name="ngayDang"
        ngModel
        #ngayDang="ngModel"
      />
      <label style="font-weight: bold;">Hình ảnh:</label>
      <input
        type="file"
        class="form-control my-1"
        (change)="onChange($event)"
        name="Anh"
        ngModel
        #Anh="ngModel"
      />

      <div class="mt-3 d-flex justify-content-end">
        <button type="submit" class="btn btn-success btn-lg btn-block">
          Thêm
        </button>
        <!--  <button
          type="button"
          (click)="displayAdd=false"
          class="btn btn-danger btn-lg btn-block"
        >
          Huỷ
        </button> -->
      </div>
    </div>
  </form>
</p-dialog>

<p-dialog
  [(visible)]="isEdit"
  [style]="{width: '40vw'}"
  [dismissableMask]="true"
  [modal]="true"
>
  <!-- Content -->
  <form (ngSubmit)="SaveData()" #form="ngForm">
    <h3>Cập nhật tin tức</h3>

    <div style="width: 100%;">
      <label style="font-weight: bold;">Tiêu đề:</label>
      <input
        type="text"
        class="form-control my-1"
        [(ngModel)]="blog.tieuDe"
        name="tieuDe"
        placeholder="Tiêu đề"
      />
      <label style="font-weight: bold;">Mô tả:</label>
      <p-editor
        [style]="{'height':'220px','font-size':'16px'}"
        name="moTa"
        ngModel
        #moTa="ngModel"
        [(ngModel)]="blog.moTa"
        class="my-1"
      ></p-editor>
      <label style="font-weight: bold;">Nội dung:</label>
      <p-editor
        [style]="{'height':'220px','font-size':'16px'}"
        name="noiDung"
        ngModel
        #noiDung="ngModel"
        [(ngModel)]="blog.noiDung"
        class="my-1"
      ></p-editor>
      <label style="font-weight: bold;">Người đăng:</label>
      <input
        type="text"
        class="form-control my-1"
        placeholder="Người đăng"
        name="maNguoiDung"
        ngModel
        #maNguoiDung="ngModel"
        [(ngModel)]="blog.nguoiDang"
      />
      <label style="font-weight: bold;">Ngày đăng:</label>
      <input
        type="date"
        class="form-control my-1"
        name="ngaydang"
        ngModel
        #ngayDang="ngModel"
        [(ngModel)]="blog.ngayDang"
      />
      <label style="font-weight: bold;">Hình ảnh:</label>
      <div>
        <img
          ng-if="anh"
          src="../../../../assets/images/img/{{blog.anh}}"
          style="width: 150px; height: 100px; margin-right: 10px;"
        />
        <input
          type="file"
          class="form-control my-1"
          (change)="onChange($event)"
          name="Anh"
          ngModel
          #Anh="ngModel"
        />
      </div>
      <div class="mt-3 d-flex justify-content-end">
        <button type="submit" class="btn btn-success btn-lg btn-block">
          Thêm
        </button>
        <!--  <button
          type="button"
          (click)="displayAdd=false"
          class="btn btn-danger btn-lg btn-block"
        >
          Huỷ
        </button> -->
      </div>
    </div>
  </form>
</p-dialog>

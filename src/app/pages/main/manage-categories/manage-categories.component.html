<div class="top d-flex justify-content-between">
  <h2>Danh sách loại sản phẩm</h2>
  <div class="right">
    <p-button
      style="margin-right: 5px;"
      (click)="showAdd()"
      icon="pi pi-plus"
      label="Thêm"
    ></p-button>

    <p-button
      (click)="exportExcel()"
      icon="pi pi-external-link"
      label="Export data"
    ></p-button>
  </div>
</div>
<div class="bot">
  <p-panel header="Tìm kiếm" [style]="{'margin-top': '2px'}">
    <form
      class="form-horizontal"
      role="form"
      [formGroup]="formsearch"
      (ngSubmit)="search()"
    >
      <div class="form-group">
        <label class="col-sm-2 control-label no-padding-right">
          Tên loại sản phẩm
        </label>
        <div class="col-sm-10 my-2">
          <input
            formControlName="tenLoai"
            class="form-control p-2"
            type="text"
            placeholder="Tên loại sản phẩm..."
          />
        </div>
      </div>
      <div class="form-group">
        <!--  <label class="col-sm-1 control-label no-padding-right"></label> -->
        <div class="col-sm-11">
          <button
            (click)="search()"
            class="btn btn-sm btn-primary font-size-16 mt-2"
            style="padding: 6px 12px;"
          >
            Tìm kiếm
          </button>
        </div>
      </div>
    </form>
    <!-- Start Sort Select Option -->
    <div
      class="sort-select-list d-flex align-items-center mt-3 justify-content-end"
    >
      <div class="d-flex" style="margin-right: auto;">
        <label class="mx-2 d-flex align-items-center">Hiển thị:</label>
        <fieldset>
          <select
            class="form-control"
            [(ngModel)]="pageSize"
            (ngModelChange)="loadPage(1)"
          >
            <option selected value="3">3</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="20">50</option>
            <option value="{{totalItems}}">All</option>
          </select>
        </fieldset>
      </div>
      <button class="btn btn-success btn-block" (click)="openPDF()">
        Download PDF
      </button>
    </div>
    <!-- End Sort Select Option -->
    <!-- <div class="col-md-4 text-right">
    <button class="btn btn-success btn-block" (click)="openPDF()">
      Download PDF
    </button>
  </div> -->
  </p-panel>
  <p-table
    id="category"
    selectionMode="single"
    [value]="categories"
    styleClass="p-datatable-gridlines"
    [style]="{'margin-top': '1rem', 'width': '100%'}"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>STT</th>
        <th>Tên loại</th>
        <th>Nhóm</th>
        <th>Mô tả</th>
        <th>Hình ảnh</th>
        <th>Thao tác</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-category let-i="rowIndex">
      <tr>
        <td>{{i+1}}</td>
        <td>{{category.tenLoai}}</td>
        <td>{{category.tenNhom}}</td>
        <td [innerHtml]="category.moTa"></td>
        <td>
          <img
            src="./../../../../assets/images/products/home-1/{{category.anh}}"
            width="150px"
            height="100px"
            alt=""
          />
        </td>
        <td>
          <button
            pButton
            type="button"
            (click)="edit(category)"
            title="Sửa"
            class="btn btn-sm btn-primary"
            style="margin-right: 5px;"
          >
            <i class="fas fa-edit"></i>
          </button>
          <!--  <button
            pButton
            type="button"
            (click)="remove(category.maLoai)"
            title="Xóa"
            class="p-button-danger"
          >
            <i class="fas fa-trash"></i>
          </button> -->
        </td>
      </tr>
    </ng-template>
  </p-table>
  <div class="mt-5 d-flex justify-content-center">
    <ngb-pagination
      [collectionSize]="totalItems"
      [pageSize]="pageSize"
      [(page)]="page"
      [maxSize]="10"
      [rotate]="true"
      (pageChange)="loadPage($event)"
    ></ngb-pagination>
  </div>
</div>

<!-- Add -->
<p-dialog
  [(visible)]="displayAdd"
  [style]="{width: '30vw'}"
  [dismissableMask]="true"
  [modal]="true"
>
  <form (ngSubmit)="AddNew(form)" #form="ngForm">
    <h3>Thêm loại sản phẩm</h3>
    <div style="width: 100%;">
      <input type="hidden" name="maLoai" ngModel #maLoai="ngModel" />
      <label style="font-weight: bold;">Tên loại:</label>
      <input
        type="text"
        class="form-control"
        name="tenLoai"
        ngModel
        #tenLoai="ngModel"
        placeholder="Tên loại sản phẩm"
      />
      <label style="font-weight: bold;">Nhóm sản phẩm:</label>
      <p-dropdown
        class="form-control"
        [options]="productsGroup"
        [(ngModel)]="selectedProductGroup"
        placeholder="Chọn nhóm sản phẩm"
        optionLabel="tenNhom"
        optionValue="maNhom"
        [showClear]="true"
        name="maNhom"
        ngModel
        #maNhom="ngModel"
        [style]="{'width':'100%'}"
      ></p-dropdown>
      <label style="font-weight: bold;">Mô tả:</label>
      <p-editor
        [style]="{'height':'320px'}"
        name="moTa"
        ngModel
        #moTa="ngModel"
      ></p-editor>
      <label style="font-weight: bold;">Hình ảnh:</label>
      <input
        type="file"
        class="form-control"
        (change)="onChange($event)"
        name="Anh"
        ngModel
        #Anh="ngModel"
      />
      <div class="mt-3">
        <div class="mt-3 d-flex justify-content-end">
          <button type="submit" class="btn btn-success btn-lg btn-block">
            Thêm
          </button>
          <!--  <button
            type="button"
            (click)="displayAdd=false"
            class="btn btn-danger btn-lg btn-block"
          >
            Huỷ
          </button> -->
        </div>
      </div>
    </div>
  </form>
</p-dialog>
<!-- Edit -->
<p-dialog
  [(visible)]="isEdit"
  [style]="{width: '30vw'}"
  [dismissableMask]="true"
  [modal]="true"
>
  <form action="" (ngSubmit)="SaveData()" #form="ngForm">
    <h3>Sửa loại sản phẩm</h3>
    <div style="width: 100%;">
      <label style="font-weight: bold;">Tên loại:</label>
      <input
        type="text"
        class="form-control"
        placeholder="Tên loại"
        [(ngModel)]="category.tenLoai"
        name="tenSanPham"
      />
      <label style="font-weight: bold;">Tên nhóm:</label>
      <p-dropdown
        class="form-control"
        [options]="productsGroup"
        [(ngModel)]="selectedProductGroup"
        placeholder="Chọn nhóm sản phẩm"
        optionLabel="tenNhom"
        optionValue="maNhom"
        [showClear]="true"
        name="maNhom"
        ngModel
        #maNhom="ngModel"
        [(ngModel)]="category.maNhom"
        [style]="{'width':'100%'}"
      ></p-dropdown>
      <label style="font-weight: bold;">Mô tả:</label>
      <p-editor
        [style]="{'height':'210px','font-size':'16px'}"
        name="moTa"
        ngModel
        #moTa="ngModel"
        [(ngModel)]="category.moTa"
      ></p-editor>
      <label style="font-weight: bold;">Hình ảnh:</label>

      <div>
        <img
          ng-if="anh"
          src="../../../../assets/images/img/{{category.anh}}"
          style="
            width: 150px;
            height: 100px;
            margin-right: 10px;
            margin-bottom: 10px;
          "
        />
        <input
          type="file"
          class="form-control"
          (change)="onChange($event)"
          name="Anh"
          [(ngModel)]="category.anh"
          ngModel
          #Anh="ngModel"
        />
      </div>
      <div class="mt-3">
        <div class="mt-3 d-flex justify-content-end">
          <button type="submit" class="btn btn-success btn-lg btn-block">
            Cập nhật
          </button>
          <!--  <button
            type="button"
            (click)="displayAdd=false"
            class="btn btn-danger btn-lg btn-block"
          >
            Huỷ
          </button> -->
        </div>
      </div>
    </div>
  </form>
</p-dialog>

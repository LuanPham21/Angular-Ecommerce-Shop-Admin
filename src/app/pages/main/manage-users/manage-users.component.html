<div class="top d-flex justify-content-between">
  <h2>Danh sách người dùng</h2>
  <div class="right">
    <!-- <button class="btnX" pButton type="button" (click)="showAdd()" lable="Thêm"></button> -->
    <p-button
      (click)="showAdd()"
      icon="pi pi-plus"
      label="Thêm"
      style="margin-right: 5px;"
    ></p-button>

    <p-button
      (click)="exportExcel()"
      icon="pi pi-external-link"
      label="Xuất dữ liệu"
    ></p-button>
  </div>
</div>
<div class="bot">
  <p-panel header="Tìm kiếm" [style]="{'margin-top': '2px'}">
    <form
      class="form-horizontal"
      role="form"
      [formGroup]="formsearch"
      (ngSubmit)="search()"
    >
      <div class="form-group">
        <label class="col-sm-1 control-label no-padding-right"> Họ tên </label>
        <div class="col-sm-11 my-2">
          <input
            formControlName="hoTen"
            class="form-control p-2"
            type="text"
            placeholder="Họ tên..."
          />
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-1 control-label no-padding-right">
          Tài khoản
        </label>
        <div class="col-sm-11 my-2">
          <input
            formControlName="taiKhoan"
            class="form-control p-2"
            type="text"
            placeholder="Tài khoản..."
          />
        </div>
      </div>
      <div class="form-group">
        <!-- <label class="col-sm-1 control-label no-padding-right"></label> -->
        <div class="col-sm-11">
          <button
            (click)="search()"
            class="btn btn-sm btn-primary font-size-16 mt-2"
            style="padding: 6px 12px;"
          >
            Tìm kiếm
          </button>
        </div>
      </div>
    </form>
    <!-- Start Sort Select Option -->
    <div
      class="sort-select-list d-flex align-items-center mt-3 justify-content-end"
    >
      <div class="d-flex" style="margin-right: auto;">
        <label class="mx-2 d-flex align-items-center">Hiển thị:</label>
        <fieldset>
          <select
            class="form-control"
            [(ngModel)]="pageSize"
            (ngModelChange)="loadPage(1)"
          >
            <option selected value="3">3</option>
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="20">50</option>
            <option value="{{totalItems}}">All</option>
          </select>
        </fieldset>
      </div>
      <button class="btn btn-success btn-block" (click)="openPDF()">
        Download PDF
      </button>
    </div>
    <!-- End Sort Select Option -->
    <!--  <div class="col-md-4 text-right">
      <button class="btn btn-success btn-block" (click)="openPDF()">
        Download PDF
      </button>
    </div> -->
  </p-panel>
  <p-table
    id="user"
    selectionMode="single"
    [value]="users"
    styleClass="p-datatable-gridlines"
    [style]="{'margin-top': '1rem', 'width': '100%'}"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>STT</th>
        <th>Họ tên</th>
        <!--  <th>Ngày sinh</th> -->
        <th>Địa chỉ</th>
        <th>Giới tính</th>
        <th>Email</th>
        <th>Tài khoản</th>
        <th>Quyền</th>
        <th>Hình ảnh</th>
        <!-- <th>Thao tác</th> -->
      </tr>
    </ng-template>
    <ng-template
      pTemplate="body"
      let-user
      let-i="rowIndex"
      let-expanded="expanded"
    >
      <tr>
        <td>{{i+1}}</td>
        <td>{{user.hoTen}}</td>
        <!-- <td>{{user.ngaySinh}}</td> -->
        <td>{{user.diaChi}}</td>
        <td>{{user.gioiTinh}}</td>
        <td>{{user.email}}</td>
        <td>{{user.taiKhoan}}</td>
        <td>{{user.role}}</td>
        <td>{{user.anh}}</td>
        <!--  <td>
          <button
            pButton
            type="button"
            (click)="showEdit(user)"
            title="Sửa"
            class="btn btn-sm btn-primary"
            style="margin-right: 5px;"
          >
            <i class="fas fa-edit"></i>
          </button>
          <button
            pButton
            type="button"
            (click)="delete(user.maNguoiDung)"
            title="Xóa"
            class="p-button-danger"
          >
            <i class="fas fa-trash"></i>
          </button>
        </td> -->
      </tr>
    </ng-template>
  </p-table>
  <div class="mt-5 d-flex justify-content-center">
    <ngb-pagination
      [collectionSize]="totalItems"
      [pageSize]="pageSize"
      [(page)]="page"
      [maxSize]="10"
      [rotate]="true"
      (pageChange)="loadPage($event)"
    ></ngb-pagination>
  </div>
</div>

<!-- Add -->
<p-dialog
  [(visible)]="display"
  [style]="{width: '50vw'}"
  [dismissableMask]="true"
  [modal]="true"
>
  <form
    *ngIf="doneSetupForm"
    [formGroup]="formdata"
    (ngSubmit)="onSubmit(formdata.value)"
  >
    <h3 *ngIf="isCreate">Thêm người dùng</h3>
    <h3 *ngIf="!isCreate">Sửa người dùng</h3>
    <div>
      <label style="font-weight: bold;">Họ tên:</label>
      <input
        type="text"
        class="form-control my-1"
        placeholder="Họ tên"
        formControlName="hoTen"
      />
      <div *ngIf="submitted && f.hoTen.errors" class="invalid-feedback">
        <div *ngIf="f.hoTen.errors.required">Họ tên là bắt buộc</div>
      </div>
      <label style="font-weight: bold;">Ngày sinh:</label>
      <p-calendar
        class="form-control my-1"
        formControlName="ngaySinh"
        [dateFormat]="dateFormat"
        [locale]="locale_vn"
        [showIcon]="true"
        inputId="icon"
      ></p-calendar>
      <div *ngIf="submitted && f.ngaySinh.errors" class="invalid-feedback">
        <div *ngIf="f.ngaySinh.errors.required">Ngày sinh là bắt buộc</div>
      </div>
      <label style="font-weight: bold;">Địa chỉ:</label>
      <input
        type="text"
        class="form-control my-1"
        formControlName="diaChi"
        placeholder="Địa chỉ"
      />
      <label style="font-weight: bold;">Email:</label>
      <input
        type="text"
        class="form-control my-1"
        formControlName="email"
        placeholder="Email"
      />
      <div *ngIf="submitted && f.email.errors" class="invalid-feedback">
        <div *ngIf="f.email.errors.required">Email là bắt buộc</div>
        <div *ngIf="f.email.errors.email">
          Địa chỉ email không đúng định dạng
        </div>
      </div>
      <label style="font-weight: bold;">Giới tính:</label>
      <p-dropdown
        [options]="genders"
        formControlName="gioiTinh"
        [style]="{'width':'100%'}"
        class="my-1"
      ></p-dropdown>
      <div *ngIf="submitted && f.gioiTinh.errors" class="invalid-feedback">
        <div *ngIf="f.gioiTinh.errors.required">Giới tính là bắt buộc</div>
      </div>

      <label class="control-label no-padding-right" style="font-weight: bold;">
        Tài khoản(<span style="color: red;">*</span>)</label
      >

      <input
        type="text"
        class="form-control my-1"
        formControlName="taiKhoan"
        placeholder="Tài khoản"
      />
      <div *ngIf="submitted && f.taiKhoan.errors" class="invalid-feedback">
        <div *ngIf="f.taiKhoan.errors.required">Tài khoản là bắt buộc</div>
      </div>

      <label class="control-label no-padding-right" style="font-weight: bold;">
        Loại quyền(<span style="color: red;">*</span>)</label
      >

      <p-dropdown
        class="form-control my-1"
        [options]="roles"
        formControlName="role"
        [style]="{'width':'100%'}"
      ></p-dropdown>
      <div *ngIf="submitted && f.role.errors" class="invalid-feedback">
        <div *ngIf="f.role.errors.required">Loại quyền là bắt buộc</div>
      </div>

      <label class="control-label no-padding-right" style="font-weight: bold;">
        Mật khẩu(<span style="color: red;">*</span>)</label
      >

      <input
        type="password"
        class="form-control my-1"
        formControlName="matKhau"
        placeholder="Mật khẩu"
      />
      <div *ngIf="submitted && f.matKhau.errors" class="invalid-feedback">
        <div *ngIf="f.matKhau.errors.required">Mật khẩu là bắt buộc</div>
        <div *ngIf="f.matKhau.errors.matkhau">
          Độ dài mật khẩu tối thiệu phải là 6 ký tự và phải chứa ký tự đặc biệt
          @#!$%&*
        </div>
      </div>

      <label class="control-label no-padding-right" style="font-weight: bold;">
        Nhập lại mật khẩu(<span style="color: red;">*</span>)</label
      >

      <input
        type="password"
        class="form-control my-1"
        formControlName="nhaplaimatkhau"
        placeholder="Nhập lại mật khẩu"
      />
      <div
        *ngIf="submitted && f.nhaplaimatkhau.errors"
        class="invalid-feedback"
      >
        <div *ngIf="f.nhaplaimatkhau.errors.required">
          Xác nhận lại mật khẩu là bắt buộc
        </div>
        <div *ngIf="f.nhaplaimatkhau.errors.mustMatch">
          Xác thực lại mật khẩu không đúng
        </div>
      </div>
    </div>
    <p-footer>
      <div class="mt-3 d-flex justify-content-end">
        <button type="submit" class="btn btn-success btn-lg btn-block">
          Thêm
        </button>
        <!--  <button
          type="button"
          (click)="displayAdd=false"
          class="btn btn-danger btn-lg btn-block"
        >
          Huỷ
        </button> -->
      </div>
    </p-footer>
  </form>
</p-dialog>
